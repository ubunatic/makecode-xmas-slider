namespace SpriteKind {
    export const Ground = SpriteKind.create()
}
function addGroundAt (x: number, y: number) {
    _ground = sprites.create(img`
        ................................................................................................................................................................
        1111............................................................................................................................................................
        111111..........................................................................................................................................................
        1111111.........................................................................................................................................................
        111111111.......................................................................................................................................................
        11111111111.....................................................................................................................................................
        111111111111....................................................................................................................................................
        1111111111111...................................................................................................................................................
        1111111111111111111.............................................................................................................................................
        111111111111111111111...........................................................................................................................................
        11111111111111111111111.........................................................................................................................................
        111111111111111111111111........................................................................................................................................
        1111111111111111111111111.......................................................................................................................................
        111111111111111111111111111.....................................................................................................................................
        1111111111111111111111111111....................................................................................................................................
        11111111111111111111111111111...................................................................................................................................
        111111111111111111111111111111..................................................................................................................................
        1111111111111111111111111111111.................................................................................................................................
        1111111111111111111111111111111.................................................................................................................................
        11111111111111111111111111111111................................................................................................................................
        11111111111111111111111111111111................................................................................................................................
        11111111111111111111111111111111................................................................................................................................
        111111111111111111111111111111111...............................................................................................................................
        1111111111111111111111111111111111..............................................................................................................................
        11111111111111111111111111111111111.............................................................................................................................
        111111111111111111111111111111111111............................................................................................................................
        111111111111111111111111111111111111............................................................................................................................
        1111111111111111111111111111111111111...........................................................................................................................
        1111111111111111111111111111111111111...........................................................................................................................
        11111111111111111111111111111111111111..........................................................................................................................
        111111111111111111111111111111111111111.........................................................................................................................
        111111111111111111111111111111111111111.........................................................................................................................
        111111111111111111111111111111111111111.........................................................................................................................
        1111111111111111111111111111111111111111........................................................................................................................
        11111111111111111111111111111111111111111.......................................................................................................................
        111111111111111111111111111111111111111111......................................................................................................................
        111111111111111111111111111111111111111111......................................................................................................................
        1111111111111111111111111111111111111111111.....................................................................................................................
        111111111111111111111111111111111111111111111...................................................................................................................
        11111111111111111111111111111111111111111111111.................................................................................................................
        1111111111111111111111111111111111111111111111111111............................................................................................................
        1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111........................................................................
        1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111.....................................................................
        111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111................................................................
        11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111............................................
        111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111........................................
        11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111......................................
        1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111....................................
        11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111................................
        111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111...............................
        111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111............................
        111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111.........................
        1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111........................
        11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111.......................
        1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111..................
        1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111............
        111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111.......
        111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111....
        11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111..
        1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        `, SpriteKind.Ground)
    _ground.left = x
    _ground.top = y
    _ground.image.fillRect(0, 60, 160, 120, 1)
    return _ground
}
function updatePlayer (sprite: Sprite) {
    if (sprite.x > 40) {
        sprite.vx = 0
    }
    if (isOnGround(sprite)) {
        if (sprite.vy > 5) {
            sprite.startEffect(effects.blizzard, 300)
        }
        if (sprite.vy > 1) {
            bounce(sprite, -0.3)
        } else {
            sprite.y += -1
        }
    }
}
function updateSpeedMeter () {
    speed_meter.setText("" + Math.round(speed * 10) + " km/h")
}
controller.B.onEvent(ControllerButtonEvent.Pressed, function () {
    speed += -0.2
})
controller.A.onEvent(ControllerButtonEvent.Pressed, function () {
    speed += 0.1
})
function limitSpeed () {
    speed = Math.constrain(speed, 0, 3)
}
function bounce (sprite: Sprite, ratio: number) {
    sprite.vy = sprite.vy * ratio
}
function isOnGround (sprite: Sprite) {
    return sprite.overlapsWith(ground) || sprite.overlapsWith(ground_next)
}
controller.B.onEvent(ControllerButtonEvent.Repeated, function () {
    speed += -0.2
})
function moveGround () {
    ground.left += -1 * speed
    ground.top += -0.375 * speed
    ground_next.left += -1 * speed
    ground_next.top += -0.375 * speed
    if (ground.left <= 0 - scene.screenWidth()) {
        ground.destroy()
        ground = ground_next
        ground_next = addGroundAt(ground.right, 90)
    }
}
controller.A.onEvent(ControllerButtonEvent.Repeated, function () {
    speed += 0.1
})
let _ground: Sprite = null
let speed_meter: TextSprite = null
let speed = 0
let ground_next: Sprite = null
let ground: Sprite = null
let santa = sprites.create(img`
    . . . . 2 2 . . . . . . . . . . 
    . . . 2 2 2 2 . . . . . . . . . 
    . . 2 2 1 d d . . . . . . . . . 
    . 1 . . 1 1 d 1 . . . . . . . . 
    . . . c c 1 1 1 . . . . . . . . 
    . . b e b c 2 1 . . . . . . . . 
    . b e e b e 2 2 d b . . . . . . 
    . e e e c b e e e . b b . . . . 
    . . e c b 2 2 2 2 2 . . b b f . 
    . . . 4 e 4 e 4 c c 4 e 4 . f . 
    . . . . . f . . c c c . . f f . 
    . . . f f f f f f f f f f f . . 
    . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . 
    `, SpriteKind.Player)
santa.setPosition(0, 0)
santa.vx = 50
santa.vy = 50
santa.ay = 30
scene.setBackgroundColor(9)
ground = addGroundAt(0, 30)
ground_next = addGroundAt(scene.screenWidth(), 90)
speed = 3
speed_meter = textsprite.create("")
speed_meter.left = 60
speed_meter.top = 2
game.onUpdate(function () {
    limitSpeed()
    moveGround()
    updatePlayer(santa)
    updateSpeedMeter()
})
